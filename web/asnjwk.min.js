var Util={};
(function(p){var g=p.btoa,d=p.atob;Util.debugLog=function(d){};Util.debugAssert=function(d,m){};Util.hexDump=function(d,m,g){m=m||0;g=g?m+g:d.length;var u="";if(g>d.length)return u;for(;m<g;++m){var t;t=d[m];t="0123456789ABCDEF".charAt(t>>4&15)+"0123456789ABCDEF".charAt(t&15);u+=t}return u};Util.base64={stringify:function(d){return g(String.fromCharCode.apply(0,d))},stringifyUrlSafe:function(d){return Util.base64.stringify(d).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},parse:function(g){g=g.replace(/-/g,
"+").replace(/_/g,"/").replace(/\s/g,"");return new Uint8Array(Array.prototype.map.call(d(g),function(d){return d.charCodeAt(0)}))}}})(this);var AbvStream;
(function(p){var g=p.Util;AbvStream=function(d,p){d instanceof AbvStream?(g.debugAssert(!p),this.abv=d.abv,this.position=d.position):(this.abv=d,this.position=p||0)};AbvStream.prototype={readByte:function(){return this.abv[this.position++]},writeByte:function(d){g.debugAssert(1<=this.getRemaining());this.abv[this.position++]=d},peekByte:function(d){g.debugAssert(0<=d&&d<=this.abv.length);return this.abv[d]},copyBytes:function(d,p,m){g.debugAssert(this.getRemaining()>=m);var y=new Uint8Array(this.abv.buffer,
this.position,m);d=new Uint8Array(d.buffer,p,m);y.set(d);this.position+=m},seek:function(d){g.debugAssert(0<=d&&d<=this.abv.length);this.position=d},skip:function(d){g.debugAssert(d<=this.getRemaining());this.position+=d},getPosition:function(){return this.position},setPosition:function(d){g.debugAssert(d<=this.abv.length);this.position=d},getRemaining:function(){return this.abv.length-this.position},getLength:function(){return this.abv.length},isEndOfStream:function(){return this.position>=this.abv.length},
show:function(){var d;return d="AbvStream: pos "+(this.getPosition().toString()+" of "+this.getLength().toString())}}})(this);var ASN1={};
(function(p){function g(a,b){b.writeByte(a.tagClass<<6|a.constructed<<5|a.tag);var c=a.payloadLen;if(128>c)b.writeByte(c);else{for(var r=c,d=0;r;)++d,r>>=8;b.writeByte(128|d);for(r=0;r<d;++r)b.writeByte(c>>8*(d-r-1)&255)}if(a.child)for(a.tag==e.BIT_STRING&&b.writeByte(0),c=a._child;c;){if(!g(c,b))return!1;c=c.next}else switch(a.tag){case e.INTEGER:a.backingStore[a.dataIdx]>>7&&b.writeByte(0);b.copyBytes(a.backingStore,a.dataIdx,a.dataLen);break;case e.BIT_STRING:b.writeByte(0);b.copyBytes(a.backingStore,
a.dataIdx,a.dataLen);break;case e.OCTET_STRING:b.copyBytes(a.backingStore,a.dataIdx,a.dataLen);break;case e.NULL:break;case e.OBJECT_IDENTIFIER:k.debugAssert(m(a.backingStore,a.dataIdx,a.dataLen));b.copyBytes(a.backingStore,a.dataIdx,a.dataLen);break;case e.SET:case e.SEQUENCE:k.debugAssert(!1,"found constructed type "+l[a.tag]+" with no children");break;default:k.debugAssert(!1,"unhandled type "+l[a.tag])}return!0}function d(a){var b=a.readByte(),c=b&127;if(c==b)return c;if(3<c||0===c)return-1;for(var e=
b=0;e<c;++e)b=b<<8|a.readByte();return b}function D(a,b,c){var r=a.backingStore,q=new A(r,b);b+=c;var f=a,h,n,g;if(B++>K)k.debugLog("asn1Parse max recursion depth exceeded");else{k.debugLog("==================== asn1Parse ENTER ====================");for(k.debugLog(q.show()+", len = "+c);q.getPosition()<b;){k.debugAssert(!q.isEndOfStream());k.debugLog("---- token ----");k.debugLog(q.show());c=q.getPosition();g=q.readByte();if(31==(g&31)){for(n=0;g&128;)n<<=8,n|=g&127;g=n}h=g;n=h&31;if(0>n||30<n){k.debugLog("Invalid tag found at position "+
(q.getPosition()-1));return}g=d(q);if(0>g||g>q.getRemaining()){k.debugLog("Invalid length found at position "+(q.getPosition()-1));return}f.constructed=h&32;f.tagClass=(h&192)>>6;f.tag=n;f.dataLen=g;f.dataIdx=q.getPosition();k.debugLog(l[f.tag]+" ("+f.dataIdx+","+f.dataLen+")");n=q;var m=h;h=g;if(m&32)n=!0;else if(m<e.BIT_STRING||m>e.OCTET_STRING)n=!1;else{var p=new A(n);m==e.BIT_STRING&&p.skip(1);p.readByte()>>6&1?n=!1:(m=d(p),n=p.getPosition()-n.getPosition()+m==h)}n&&(k.debugLog("(has content)"),
n=q.getPosition(),h=g,f.tag==e.BIT_STRING&&(f.dataIdx++,f.dataLen--,n++,h--),f.child=new s(r,f),D(f.child,n,h));f.tag==e.INTEGER&&(n=q.getPosition(),0==q.peekByte(n)&&q.peekByte(n+1)>>7&&(f.dataIdx++,f.dataLen--));q.skip(g);k.debugLog("tokenLength = "+(q.getPosition()-c));q.getPosition()<b&&(f.next=new s(r,f.parent),f=f.next)}B--;k.debugLog("==================== asn1Parse EXIT  ====================");return a}}function m(a,b,c){if(9!=c)return!1;for(c=0;9>c;++c)if(a[b++]!=C[c])return!1;return!0}function y(a,
b){for(var c,d=a,g=a.backingStore,f="",h=b||0;d;){for(c=0;c<h;c++)f+="  ";switch(d.tagClass){case v.UNIVERSAL:f+=l[d.tag];break;case v.APPLICATION:f+="application";break;case v.SPECIFIC:f+="context";break;case v.PRIVATE:f+="private"}f+=" ("+d.dataIdx+":"+d.dataLen+") ";if(d.tagClass==v.UNIVERSAL)switch(d.tag){case e.INTEGER:f+="("+8*d.dataLen+" bit) ";case e.UTF8_STRING:f+=k.hexDump(g,d.dataIdx,d.dataLen);case e.OBJECT_IDENTIFIER:m(g,d.dataIdx,d.dataLen)&&(f+=" (rsaEncryption)")}f+=" payloadLen = "+
d.length;f+="\n";d.child&&(f+=y(d.child,h+1));d=d.next}return f}function u(a){if(!(a&&a.child&&a.child.next&&a.child.child&&a.child.next.child))return!1;var b=a.child.child;return m(b.backingStore,b.dataIdx,b.dataLen)&&2==a.nChildren&&2==a.child.nChildren&&2==a.child.next.child.nChildren?!0:!1}function t(a){if(!(a&&a.child&&a.child.next&&a.child.next.child&&a.child.next.next&&a.child.next.next.child))return!1;var b=a.child.next.child;return m(b.backingStore,b.dataIdx,b.dataLen)&&3==a.nChildren&&2==
a.child.next.nChildren&&9==a.child.next.next.child.nChildren?!0:!1}function E(a){var b=h.createSequenceNode(),c=new z(b);c.addChild(h.createSequenceNode());c.addChild(h.createOidNode(C));c.addSibling(h.createNullNode());c.addToParent(b,h.createBitStringNode(null));c.addChild(h.createSequenceNode());c.addChild(h.createIntegerNode(a.n));c.addSibling(h.createIntegerNode(a.e));return b}function F(a){a=a.child.next.child.child;var b=a.data;a=a.next;return new x(b,a.data,null,null)}function G(a){var b=
h.createSequenceNode(),c=new z(b);c.addChild(h.createIntegerNode(new Uint8Array([0])));c.addSibling(h.createSequenceNode());c.addChild(h.createOidNode(C));c.addSibling(h.createNullNode());c.addToParent(b,h.createOctetStringNode(null));c.addChild(h.createSequenceNode());c.addChild(h.createIntegerNode(new Uint8Array([0])));c.addSibling(h.createIntegerNode(a.n));c.addSibling(h.createIntegerNode(a.e));c.addSibling(h.createIntegerNode(a.d));c.addSibling(h.createIntegerNode(a.p));c.addSibling(h.createIntegerNode(a.q));
c.addSibling(h.createIntegerNode(a.dp));c.addSibling(h.createIntegerNode(a.dq));c.addSibling(h.createIntegerNode(a.qi));return b}function H(a){var b=[];a=a.child.next.next.child.child.next;for(var c=0;8>c;c++)b.push(a.data),a=a.next;return new w(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7])}function I(a,b,c,d){if(a instanceof x||a instanceof w){for(var e=0;e<c.length;++e)if(-1==L.indexOf(c[e]))return;b={kty:"RSA",alg:b,key_ops:c,ext:void 0==d?!1:d,n:k.base64.stringifyUrlSafe(a.n),e:k.base64.stringifyUrlSafe(a.e)};
a instanceof w&&(b.d=k.base64.stringifyUrlSafe(a.d),b.p=k.base64.stringifyUrlSafe(a.p),b.q=k.base64.stringifyUrlSafe(a.q),b.dp=k.base64.stringifyUrlSafe(a.dp),b.dq=k.base64.stringifyUrlSafe(a.dq),b.qi=k.base64.stringifyUrlSafe(a.qi));return b}}function J(a){if(a.kty&&"RSA"==a.kty&&a.alg&&a.n&&a.e&&-1!=["RSA1_5","RSA-OAEP","RS256","RS384","RS512"].indexOf(a.alg)){var b=[];a.use?"enc"==a.use?b=["encrypt","decrypt","wrap","unwrap"]:"sig"==a.use&&(b=["sign","verify"]):b=a.key_ops;var c=a.ext,d=k.base64.parse(a.n),
e=k.base64.parse(a.e);if(a.d){var f=k.base64.parse(a.d),g=k.base64.parse(a.p),h=k.base64.parse(a.q),l=k.base64.parse(a.dp),m=k.base64.parse(a.dq),p=k.base64.parse(a.qi);return new w(d,e,f,g,h,l,m,p,a.alg,b,c)}return new x(d,e,c,b)}}function M(a,b,c,d){this.der=a;this.type=b;this.keyOps=c;this.extractable=d}var k=p.Util,A=p.AbvStream,v={UNIVERSAL:0,APPLICATION:1,CONTEXT_SPECIFIC:2,PRIVATE:3},e={BER:0,BOOLEAN:1,INTEGER:2,BIT_STRING:3,OCTET_STRING:4,NULL:5,OBJECT_IDENTIFIER:6,OBJECT_DESCRIPTOR:7,INSTANCE_OF_EXTERNAL:8,
REAL:9,ENUMERATED:10,EMBEDDED_PPV:11,UTF8_STRING:12,RELATIVE_OID:13,SEQUENCE:16,SET:17,NUMERIC_STRING:18,PRINTABLE_STRING:19,TELETEX_STRING:20,T61_STRING:20,VIDEOTEX_STRING:21,IA5_STRING:22,UTC_TIME:23,GENERALIZED_TIME:24,GRAPHIC_STRING:25,VISIBLE_STRING:26,ISO64_STRING:26,GENERAL_STRING:27,UNIVERSAL_STRING:28,CHARACTER_STRING:29,BMP_STRING:30},l=[];l[e.BER]="BER";l[e.BOOLEAN]="BOOLEAN";l[e.INTEGER]="INTEGER";l[e.BIT_STRING]="BIT STRING";l[e.OCTET_STRING]="OCTET STRING";l[e.NULL]="NULL";l[e.OBJECT_IDENTIFIER]=
"OBJECT IDENTIFIER";l[e.OBJECT_DESCRIPTOR]="ObjectDescriptor";l[e.INSTANCE_OF_EXTERNAL]="INSTANCE OF, EXTERNAL";l[e.REAL]="REAL";l[e.ENUMERATED]="ENUMERATED";l[e.EMBEDDED_PPV]="EMBEDDED PPV";l[e.UTF8_STRING]="UTF8String";l[e.RELATIVE_OID]="RELATIVE-OID";l[e.SEQUENCE]="SEQUENCE";l[e.SET]="SET, SET OF";l[e.NUMERIC_STRING]="NumericString";l[e.PRINTABLE_STRING]="PrintableString";l[e.TELETEX_STRING]="TeletexString, T61String";l[e.VIDEOTEX_STRING]="VideotexString";l[e.IA5_STRING]="IA5String";l[e.UTC_TIME]=
"UTCTime";l[e.GENERALIZED_TIME]="GeneralizedTime";l[e.GRAPHIC_STRING]="GraphicString";l[e.VISIBLE_STRING]="VisibleString, ISO64String";l[e.GENERAL_STRING]="GeneralString";l[e.UNIVERSAL_STRING]="UniversalString";l[e.CHARACTER_STRING]="CHARACTER STRING";l[e.BMP_STRING]="BMPString";var s=function(a,b,c,d,e,f){this._data=a;this._parent=b||void 0;this._constructed=c||!1;this._tagClass=v.UNIVERSAL;this._tag=d||0;this._dataIdx=e||0;this._dataLen=f||0};s.prototype={_child:void 0,_next:void 0,get data(){k.debugAssert(this._data);
return new Uint8Array(this._data.buffer.slice(this._dataIdx,this._dataIdx+this._dataLen))},get backingStore(){return this._data},get constructed(){return this._constructed},set constructed(a){this._constructed=0!=a?!0:!1},get tagClass(){return this._tagClass},set tagClass(a){this._tagClass=a},get tag(){return this._tag},set tag(a){this._tag=a},get dataIdx(){return this._dataIdx},set dataIdx(a){this._dataIdx=a},get dataLen(){return this._dataLen},set dataLen(a){this._dataLen=a},get child(){return this._child},
set child(a){this._child=a;this._child.parent=this},get next(){return this._next},set next(a){this._next=a},get parent(){return this._parent},set parent(a){this._parent=a},get payloadLen(){var a=0;if(this._child){for(var b=this._child;b;)a+=b.length,b=b.next;this._tag==e.BIT_STRING&&a++}else switch(this._tag){case e.INTEGER:a=this._dataLen;this._data[this._dataIdx]>>7&&a++;break;case e.BIT_STRING:a=this._dataLen+1;break;case e.OCTET_STRING:a=this._dataLen;break;case e.NULL:a=0;break;case e.OBJECT_IDENTIFIER:m(this._data,
this._dataIdx,this._dataLen)?a=9:k.debugAssert("Non RSA OID found");break;case e.SET:case e.SEQUENCE:k.debugAssert(!1,"found constructed type "+l[this._tag]+" with no children");break;default:k.debugAssert(!1,"unhandled type "+l[this._tag])}return a},get length(){var a=this.payloadLen,b;if(127<a)for(b=a;b;)b>>=8,++a;return a+2},get der(){var a=this.length;if(a){var b=new Uint8Array(a);k.debugLog("created abv of length "+a);a=new A(b);if(g(this,a))return b;k.debugLog("der: buildDer failed")}else k.debugLog("der: found zero length")},
get nChildren(){for(var a=0,b=this._child;b;)a++,b=b.next;return a}};var h={createSequenceNode:function(){return new s(null,null,!0,e.SEQUENCE,null,null)},createOidNode:function(a){return new s(a,null,!1,e.OBJECT_IDENTIFIER,0,a?a.length:0)},createNullNode:function(){return new s(null,null,!1,e.NULL,null,null)},createBitStringNode:function(a){return new s(a,null,!1,e.BIT_STRING,0,a?a.length:0)},createIntegerNode:function(a){return new s(a,null,!1,e.INTEGER,0,a?a.length:0)},createOctetStringNode:function(a){return new s(a,
null,!1,e.OCTET_STRING,0,a?a.length:0)}},z=function(a){this._currentNode=this._rootNode=a};z.prototype={addChild:function(a){this.addTo(this._currentNode,a)},addSibling:function(a){this.addTo(this._currentNode.parent,a)},addTo:function(a,b){this._currentNode=b;this._currentNode.parent=a;if(a.child){for(var c=a.child;c.next;)c=c.next;c.next=b}else a.child=b},addToParent:function(a,b){this.findNode(a)&&this.addTo(a,b)},findNode:function(a){for(var b=this._currentNode;b;){if(a==b)return!0;b=b.parent}return!1}};
var B=0,K=8,C=new Uint8Array([42,134,72,134,247,13,1,1,1]),x=function(a,b,c,d){this.n=a;this.e=b;this.ext=c;this.keyOps=d},w=function(a,b,c,d,e,f,g,h,k,l,m){this.n=a;this.e=b;this.d=c;this.p=d;this.q=e;this.dp=f;this.dq=g;this.qi=h;this.alg=k;this.keyOps=l;this.ext=m},L="sign verify encrypt decrypt wrap unwrap deriveKey deriveBits".split(" ");ASN1.parse=function(a){B=0;return D(new s(a),0,a.length)};ASN1.show=y;ASN1.isRsaSpki=u;ASN1.isRsaPkcs8=t;ASN1.NodeFactory=h;ASN1.Builder=z;ASN1.tagVal=e;ASN1.RsaPublicKey=
x;ASN1.RsaPrivateKey=w;ASN1.buildRsaSpki=E;ASN1.parseRsaSpki=function(a){a=ASN1.parse(a);return u?F(a):void 0};ASN1.buildRsaPkcs8=G;ASN1.parseRsaPkcs8=function(a){a=ASN1.parse(a);return t(a)?H(a):void 0};ASN1.buildRsaJwk=I;ASN1.parseRsaJwk=J;ASN1.rsaDerToJwk=function(a,b,c,d){if(a=ASN1.parse(a)){if(u(a))a=F(a);else if(t(a))a=H(a);else return;return I(a,b,c,d)}};ASN1.jwkToRsaDer=function(a){if(a=J(a)){var b,c;if(a instanceof x)b="spki",c=E(a).der;else if(a instanceof w)b="pkcs8",c=G(a).der;else return;
return new M(c,b,a.keyOps,a.ext)}};ASN1.webCryptoUsageToJwkKeyOps=function(a){return a.map(function(a){return"wrapKey"==a?"wrap":"unwrapKey"==a?"unwrap":a})};ASN1.webCryptoAlgorithmToJwkAlg=function(a){if("RSAES-PKCS1-v1_5"==a.name)return"RSA1_5";if("RSASSA-PKCS1-v1_5"==a.name){if("SHA-256"==a.hash.name)return"RS256";if("SHA-384"==a.hash.name)return"RS384";if("SHA-512"==a.hash.name)return"RS512"}}})(this);
